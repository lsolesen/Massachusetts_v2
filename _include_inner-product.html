<{strip}>
<{assign var="innerproduct" value="product_cache_"|cat:$product->getProductId()}>
<{if $settings.Caching.MaxLevetidProduktTeaser && $settings.Caching.MinLevetidProduktTeaser}>
    <{assign var="randomttl" value=$settings.Caching.MinLevetidProduktTeaser|mt_rand:$settings.Caching.MaxLevetidProduktTeaser}>
<{else}>
    <{assign var="randomttl" value=43200|mt_rand:86400}>
<{/if}>

<{get_cache name=$innerproduct ttl=$randomttl assign="inner_product_cached_data"}>

<{if $inner_product_cached_data}>

    <{$inner_product_cached_data}>

<{else}>

    <{cache name=$innerproduct}>

<{assign var="splat" value=$product->getMetaValue('splat') }>
<{assign var="images" value=$product->getImages()}>
<{assign var="supplier" value=$product->getSupplier()}>
<{assign var="profile" value=$product->getProfile()}>
<{assign var="attr" value=$profile->getAttributeList()}>


<{assign var="attr" value=$product->getAttributes()}>
<{assign var="attributes" value=""}>
<{assign var="variant" value=""}>
<{section name="j" loop=$attr}>
    <{assign var="values" value=$attr[j]->getValues()}>
    <{if $attr[j]->getIsVariant() && $attr[j]->getDataType() == "valuelist"}>
        <{section name="k" loop=$values}>

            <{if $product->getInStock($attr[j]->getAttributeId(), $values[k]->getAttributeValueId()) > 0}>
                <{assign var="temp" value=$values[k]->getVal()|escape}>
                <{assign var="variant" value="$variant $temp"}>
            <{/if}>

        <{/section}>
    <{else}>

        <{* Jeg kan ikke få attr til at returnere noget *}>
        <{* Hvis den gjorde det, vil jeg tro, at jeg kunne få den til kun at hente attributter på produktet *}>
        <{* og hvis den gjorde - hvordan kunne jeg så få den ind i en variabel? *}>
        <{attr name=$attr[j]->getName()}>
        <{$attr[j]->getVal()}>

        <{* $attributes ender med at få alle de mulige attributter - ikke kun dem på produktet *}>
        <{section name="l" loop=$values}>

            <{assign var="temp" value=$values[l]->getVal()|escape}>
            <{assign var="attributes" value="$attributes $temp"}>

        <{/section}>
    <{/if}>
<{/section}>


<li rel="product" data-attributes="<{$attributes}>" data-variant="<{$variant}>" data-id="<{$product->getProductId()}>"<{if $supplier}> data-brand="<{$supplier->getName()}>" <{/if}> class="col-xs-12 col-sm-4 col-md-3 product-teaser <{$product->getCategoryNames("filter-"," ")}> <{if $supplier}> filter-<{$supplier->getName()|lower|replace:' ':'_'|replace:'.':'_'}><{/if}>" itemscope itemtype="http://schema.org/Product">
    <div class="product-teaser-inner">
        <a href="<{$product->getRemoteUrl()|escape}>" title="<{$product->getName()|escape}>">
            <{if $attr}>
            <div class="sizes">
                <{if $product->getIsInStock() == true}>
                <span>Varianter på lager:</span>
                <ul>
                    <{section name="j" loop=$attr}>
                        <{if $attr[j]->getIsVariant() && $attr[j]->getDataType() == "valuelist"}>
                            <{assign var="values" value=$attr[j]->getValues()}>
                            <{assign var="c" value=0}>
                            <{section name="k" loop=$values}>

                                <{if $product->getInStock($attr[j]->getAttributeId(), $values[k]->getAttributeValueId()) > 0}>
                                    <{assign var="c" value=$c+1}>
                                    <{if $c < 10}>
                                        <li><{$values[k]->getVal()|escape}></li>
                                    <{elseif $c == 10}>
                                        <li>mere...</li>
                                    <{/if}>
                                <{/if}>

                            <{/section}>
                        <{/if}>
                    <{/section}>
                </ul>
                <{else}>
                <span>Produktet er i restordre:</span>
                <ul>
                    <li>Skriv dig op til at få besked, når vi får nye på lager.</li>
                </ul>
                <{/if}>
            </div>
            <{/if}>
            <{section name="j" loop=$images start=0 max=1}>
                <img src="<{$theme_url}>/img/spinner.gif" data-layzr="<{$images[j]->getSrc(240,240, 'box')}>" data-layzr-retina="<{$images[j]->getSrc(500,500, 'box')}>" class="product-image" itemprop="image" content="<{$images[j]->getSrc(400,400, 'box')}>" alt="<{$images[j]->getDescription()|escape}>" />
            <{/section}>

            <{if $product->getSalePrice() > 0}>
                <div class="product-teaser-highlight offer">
                    <{math assign="pricedif" equation='a-b' a=$product->getPrice() b=$product->getSalePrice() }>
                    <{math assign="savepercent" equation='c/d*100' c=$pricedif d=$product->getPrice()}>
                    -<{$savepercent|number_format:0}>%
                </div>
            <{elseif $product->getOnlineHours() < 480}>
                <div class="product-teaser-highlight news">NYHED</div>
            <{/if}>


            <div class="product-teaser-meta">
                <div class="product-teaser-title" itemprop="name"><{$product->getName()|escape}></div>
                <div class="product-teaser-brand" itemprop="brand"><{if $supplier}><{$supplier->getName()}><{/if}></div>
                <div class="product-teaser-text" itemprop="description"><{$product->getListDescription()|escape}></div>
                <div class="product-teaser-price" itemprop="offers" itemscope itemtype="http://schema.org/Offer">
                    <{if $product->getSalePrice()}>
                        <div class="product-teaser-price-before"><span><{$webshop->getCurrency()}></span> <span class="beforeprice"><{$product->getPrice()|number_format:2:",":"."}></span></div>
                    <{/if}>
                    <div class="product-teaser-price-current">
                        <span itemprop="priceCurrency" class="product-teaser-currency"><{$webshop->getCurrency()}></span>&nbsp;<span itemprop="price" class="product-teaser-price" content="<{$product->getRealPrice()|number_format:2:".":""}>"><{$product->getRealPrice()|number_format:2:",":"."}></span>
                    </div>
                    <{if $product->getIsInStock()}>
                        <span class="product-teaser-availability instock" >På lager</span>
                        <link itemprop="availability" href="http://schema.org/InStock" />
                    <{else}>
                        <span class="product-teaser-availability outofstock">Ikke på lager</span>
                    <{/if}>
                </div>
            </div>
        </a>


        <{if $settings.Produktlister.Laegikurvfraliste == 'ja'}>
            <{if $product->getIsInStock()}>
                <form action="" method="post" class="putinbasketform">
                    <input type="hidden" name="product_id" value="<{$product->getProductId()}>"/>
                    <input type="hidden" name="redirect" value="<{$product->getMetaValue('redirect')|escape}>"/>
                    <input type="hidden" class="form-control amount-input" name="amount" value="1">
                    <div class="product-teaser-cta">
                        <{if $product->hasVariant()}>
                                <{section name="j" loop=$attr}>
                                    <{if $attr[j]->getIsVariant()}>
                                        <{if $attr[j]->getDataType() == "valuelist"}>
                                            <{assign var="values" value=$attr[j]->getValues()}>
                                            <select name="attributes[<{$attr[j]->getAttributeId()}>]" id="a<{$attr[j]->getAttributeId()}>" class="product-variant-selectbox" required>
                                                <option value="" disabled="disabled" selected>Vælg variant</option>
                                                <{section name="k" loop=$values}>
                                                    <{assign var="attribute_price" value=$product->getAttributePrice($values[k]->getAttributeValueId())}>
                                                    <{if $product->getInStock($attr[j]->getAttributeId(), $values[k]->getAttributeValueId()) > 0}>
                                                        <option value="<{$values[k]->getAttributeValueId()}>" data-stockamount="<{$product->getInStock($attr[j]->getAttributeId(), $values[k]->getAttributeValueId())}>">
                                                            <{$values[k]->getVal()|escape}>
                                                            <{if $attribute_price}>
                                                                &nbsp;(<{$attribute_price|number_format:2:",":"."}> <{$webshop->getCurrency()}>)
                                                            <{/if}>
                                                        </option>
                                                    <{/if}>
                                                <{/section}>
                                            </select>
                                        <{elseif $attr[j]->getDataType() == "string"}>
                                            <input type="text" name="attributes[<{$attr[j]->getAttributeId()}>]" id="a<{$attr[j]->getAttributeId()}>" class="attribute"/>
                                        <{elseif $attr[j]->getDataType() == "integer"}>
                                            <input type="text" name="attributes[<{$attr[j]->getAttributeId()}>]" id="a<{$attr[j]->getAttributeId()}>" class="attribute"/>
                                        <{elseif $attr[j]->getDataType() == "boolean"}>
                                            <input type="checkbox" name="attributes[<{$attr[j]->getAttributeId()}>]" value="1" id="a<{$attr[j]->getAttributeId()}>" class="attribute"/>
                                        <{/if}>
                                    <{/if}>
                                <{/section}>
                        <{else}>
                            <input type="hidden" class="single-stock-amount" value="<{$product->getInStock($attributes[0].id, $attributes[0].value_id)}>">
                        <{/if}>

                        <button class="product-teaser-readmore btn btn-primary" type="submit" value=" "><{$settings.Produktlister.Knaptekst_koeb}></button>
                    </div>
                </form>
            <{else}>
                <div class="product-teaser-cta">
                    <a href="<{$product->getRemoteUrl()|escape}>" class="product-teaser-readmore btn btn-primary"><{$settings.Produktlister.Knaptekst_ikkepaalager}></a>
                </div>
            <{/if}>
        <{else}>
            <div class="product-teaser-cta">
                <a href="<{$product->getRemoteUrl()|escape}>" class="product-teaser-readmore btn btn-primary"><{$settings.Produktlister.Knaptekst_laesmere}></a>
            </div>
        <{/if}>
    </div>
</li>
<{/cache}>
<{/if}><{/strip}>
